name: Verify that .NET packages are consolidated
description: >
  Verifies that the NuGet packages of a .NET solution are consolidated, i.e. the same version of a given package is used
  in all projects.

inputs:
  directory:
    required: false
    default: .
    description: Path to the directory where a solution file can be found.
  solution-path:
    required: false
    default: "*.sln"
    description: >
      The path of the solution file to be processed. The value is given to PowerShell's `Get-ChildItem` cmdlet as-is, so
      grepping is still possible but a name with spaces must be escaped separately.

runs:
  using: "composite"
  steps:
    - name: Setup Scripts
      shell: pwsh
      run: |
        $Env:PSModulePath += [System.IO.Path]::PathSeparator + "$((Resolve-Path "${{ github.action_path }}/../../../Scripts").Path)"
    - name: Setup tool
      shell: pwsh
      run: |
        $env:PSModulePath -split [System.IO.Path]::PathSeparator
        Get-Module -ListAvailable
        Install-DotNetTool -Name "dotnet-consolidate" -Version "2.0.0" -Global
    - name: Verify consolidation status
      shell: pwsh
      working-directory: ${{ inputs.directory }}
      run: dotnet consolidate -s (Get-ChildItem ${{ inputs.solution-path }}).FullName
