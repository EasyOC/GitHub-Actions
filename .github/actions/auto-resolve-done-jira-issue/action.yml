name: Automatically Resolve or Done Jira issue
description: >
  Resolves the Jira issue corresponding to the pull request if the "resolve-jira-issue-if-checks-succeed" or
  "merge-and-resolve-jira-issue-if-checks-succeed"" label is present, or sets the issue to Done if the
  "done-jira-issue-if-checks-succeed" label is.

runs:
  using: "composite"
  steps:
    - name: Setup Scripts
      shell: pwsh
      run: |
        "${{ github.action_path }}" >> $Env:GITHUB_PATH
        (Resolve-Path "${{ github.action_path }}/../../../Scripts").Path >> $Env:GITHUB_PATH

    - name: Check if Should Done
      id: check-done
      uses: Lombiq/GitHub-Actions/.github/actions/check-pull-request-labels@issue/OSOE-477
      with:
        label1: "done-jira-issue-if-checks-succeed"
        label2: "dummy"

    - name: Check if Should Resolve
      id: check-resolve
      if: steps.check-done.outputs.contains-label == 'false'
      uses: Lombiq/GitHub-Actions/.github/actions/check-pull-request-labels@issue/OSOE-477
      with:
        label1: "resolve-jira-issue-if-checks-succeed"
        label2: "merge-and-resolve-jira-issue-if-checks-succeed"

    - name: Transition Jira Issue to Done
      if: steps.check-done.outputs.contains-label == 'true'
      shell: pwsh
      run: |
        Write-Output "Jira issue to Done"

    - name: Transition Jira Issue to Resolved
      if: steps.check-resolve.outputs.contains-label == 'true'
      shell: pwsh
      run: |
        Write-Output "Jira issue to Resolved"

    - name: Remove Label
      if: steps.check-done.outputs.contains-label == 'true' || steps.check-resolve.outputs.contains-label == 'true'
      # v1.1.1
      uses: mondeja/remove-labels-gh-action@9c39e92024101ccb2473aeee441d4923adf58089
      with:
        token: ${{ env.GITHUB_TOKEN }}
        labels: |
          resolve-jira-issue-if-checks-succeed
          done-jira-issue-if-checks-succeed
          merge-and-resolve-jira-issue-if-checks-succeed
